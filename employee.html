<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Karyawan - Sistem Absensi</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== CSS RESET & VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --primary-dark: #1a252f;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light-gray: #f8f9fa;
            --border-radius: 10px;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark);
            min-height: 100vh;
        }

        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .sidebar-header p {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu li.active a {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
        }

        .sidebar-menu i {
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            min-height: 100vh;
        }

        /* ===== HEADER ===== */
        .header {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-info h1 {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-info p {
            color: var(--gray);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .time-display {
            background: var(--light-gray);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-logout:hover {
            background: #c0392b;
        }

        /* ===== ATTENDANCE CARD ===== */
        .attendance-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .attendance-header {
            margin-bottom: 25px;
        }

        .attendance-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 22px;
        }

        .attendance-header p {
            color: var(--gray);
            font-size: 16px;
            font-weight: 500;
        }

        .attendance-status {
            background: var(--light-gray);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            text-align: left;
        }

        .status-item {
            padding: 10px;
        }

        .status-item label {
            display: block;
            color: var(--gray);
            font-size: 13px;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .attendance-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn-attendance {
            min-width: 200px;
            padding: 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .btn-attendance:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-checkin {
            background: var(--success);
            color: white;
        }

        .btn-checkin:hover:not(:disabled) {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-checkout {
            background: var(--secondary);
            color: white;
        }

        .btn-checkout:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-attendance i {
            font-size: 32px;
        }

        .attendance-info {
            background: #fff9e6;
            border: 1px solid #ffeaa7;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 20px;
        }

        .attendance-info p {
            color: #d35400;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        /* ===== STATISTICS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .icon-present { background: var(--success); }
        .icon-late { background: var(--warning); }
        .icon-leave { background: var(--info); }
        .icon-absent { background: var(--danger); }

        .stat-content h3 {
            font-size: 13px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .stat-progress {
            margin-top: 10px;
        }

        .progress-bar {
            height: 6px;
            background: var(--light-gray);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* ===== TABLES ===== */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .table-container h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--light-gray);
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid var(--light);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        tbody tr:hover {
            background: var(--light-gray);
        }

        /* ===== STATUS BADGES ===== */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-present { background: #d4edda; color: #155724; }
        .badge-late { background: #fff3cd; color: #856404; }
        .badge-sick { background: #d1ecf1; color: #0c5460; }
        .badge-permit { background: #e2e3e5; color: #383d41; }
        .badge-absent { background: #f8d7da; color: #721c24; }

        /* ===== RANKING SECTION ===== */
        .ranking-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .ranking-header h2 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--light-gray);
            border-radius: 10px;
            transition: var(--transition);
        }

        .ranking-item:hover {
            background: #e3f2fd;
        }

        .ranking-item.me {
            background: #e3f2fd;
            border: 2px solid var(--secondary);
        }

        .rank-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            width: 50px;
            text-align: center;
        }

        .rank-1 .rank-number { color: gold; }
        .rank-2 .rank-number { color: silver; }
        .rank-3 .rank-number { color: #cd7f32; }

        .rank-info {
            flex: 1;
        }

        .rank-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .rank-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: var(--gray);
        }

        .rank-score {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            padding-left: 20px;
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar-header h3 span,
            .sidebar-header p,
            .sidebar-menu a span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-menu {
                width: 100%;
                justify-content: space-between;
            }
            
            .attendance-buttons {
                flex-direction: column;
            }
            
            .btn-attendance {
                width: 100%;
                min-width: unset;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .dashboard {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 15px;
            }
            
            .attendance-card,
            .table-container,
            .ranking-container {
                padding: 20px;
            }
            
            .header-info h1 {
                font-size: 20px;
            }
            
            .ranking-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .rank-number {
                width: 100%;
            }
        }

        /* ===== LOADING SPINNER ===== */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-muted { color: var(--gray); }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--info);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success);
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h3>
                    <i class="fas fa-fingerprint"></i>
                    <span>ABSENSI DIGITAL</span>
                </h3>
                <p id="employeeName">Karyawan</p>
            </div>
            
            <ul class="sidebar-menu">
                <li class="active">
                    <a href="#dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#history">
                        <i class="fas fa-history"></i>
                        <span>Riwayat</span>
                    </a>
                </li>
                <li>
                    <a href="#statistics">
                        <i class="fas fa-chart-bar"></i>
                        <span>Statistik</span>
                    </a>
                </li>
                <li>
                    <a href="#ranking">
                        <i class="fas fa-trophy"></i>
                        <span>Ranking</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <button onclick="logout()" class="btn-logout" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-info">
                    <h1 id="greeting">Selamat Datang</h1>
                    <p>
                        <i class="fas fa-calendar"></i>
                        <span id="currentDate">Loading...</span>
                    </p>
                </div>
                
                <div class="user-menu">
                    <div class="time-display">
                        <i class="fas fa-clock"></i>
                        <span id="currentTime">00:00</span>
                    </div>
                    <button onclick="logout()" class="btn-logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div id="dashboardContent">
                <!-- Attendance Card -->
                <div class="attendance-card">
                    <div class="attendance-header">
                        <h2><i class="fas fa-calendar-check"></i> ABSENSI HARI INI</h2>
                        <p id="todayDate">Senin, 1 Januari 2024</p>
                    </div>
                    
                    <div class="attendance-status" id="attendanceStatus">
                        <div class="status-item">
                            <label>Status</label>
                            <div class="value" id="statusText">Belum Absen</div>
                        </div>
                        <div class="status-item">
                            <label>Waktu Masuk</label>
                            <div class="value" id="checkInTime">-</div>
                        </div>
                        <div class="status-item">
                            <label>Waktu Keluar</label>
                            <div class="value" id="checkOutTime">-</div>
                        </div>
                        <div class="status-item">
                            <label>Keterlambatan</label>
                            <div class="value" id="lateMinutes">0 menit</div>
                        </div>
                    </div>
                    
                    <div class="attendance-buttons" id="attendanceButtons">
                        <!-- Tombol absensi akan diisi oleh JavaScript -->
                    </div>
                    
                    <div id="attendanceNotes" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fas fa-sticky-note"></i>
                            <div>
                                <strong>Catatan:</strong>
                                <span id="notesText"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon icon-present">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Kehadiran Bulan Ini</h3>
                            <div class="stat-number" id="presentCount">0</div>
                            <div class="stat-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="attendanceProgress" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="attendancePercent">0%</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-late">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Keterlambatan</h3>
                            <div class="stat-number" id="lateCount">0</div>
                            <small class="text-muted">Total menit: <span id="totalLateMinutes">0</span></small>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-leave">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Izin & Sakit</h3>
                            <div class="stat-number" id="leaveCount">0</div>
                            <small class="text-muted">
                                Izin: <span id="permitCount">0</span>, 
                                Sakit: <span id="sickCount">0</span>
                            </small>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-absent">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Alfa</h3>
                            <div class="stat-number" id="absentCount">0</div>
                            <small class="text-muted">Hari tanpa absensi</small>
                        </div>
                    </div>
                </div>

                <!-- Recent History -->
                <div class="table-container">
                    <h2><i class="fas fa-history"></i> RIWAYAT ABSENSI TERAKHIR</h2>
                    <table id="recentHistory">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Masuk</th>
                                <th>Keluar</th>
                                <th>Status</th>
                                <th>Keterlambatan</th>
                                <th>Catatan</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data akan diisi oleh JavaScript -->
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-history fa-2x" style="color: #ddd; margin-bottom: 10px; display: block;"></i>
                                    <span style="color: var(--gray);">Belum ada riwayat absensi</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ranking Section -->
                <div class="ranking-container">
                    <div class="ranking-header">
                        <h2><i class="fas fa-trophy"></i> TOP 5 KARYAWAN TELADAN</h2>
                        <small class="text-muted">Bulan Ini</small>
                    </div>
                    
                    <div class="ranking-list" id="rankingList">
                        <!-- Data ranking akan diisi oleh JavaScript -->
                        <div class="ranking-item">
                            <div class="rank-number">1</div>
                            <div class="rank-info">
                                <div class="rank-name">Administrator</div>
                                <div class="rank-stats">
                                    <span>Kehadiran: 100%</span>
                                    <span>Telat: 0x</span>
                                </div>
                            </div>
                            <div class="rank-score">100</div>
                        </div>
                        
                        <div class="ranking-item me">
                            <div class="rank-number">2</div>
                            <div class="rank-info">
                                <div class="rank-name">Anda (Nita Sri Wahyuningrum)</div>
                                <div class="rank-stats">
                                    <span>Kehadiran: 95%</span>
                                    <span>Telat: 1x</span>
                                </div>
                            </div>
                            <div class="rank-score">95</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Content (Hidden by default) -->
            <div id="historyContent" style="display: none;">
                <div class="table-container">
                    <h2><i class="fas fa-history"></i> RIWAYAT ABSENSI LENGKAP</h2>
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="filterMonth" class="form-control" style="width: 200px;">
                            <option value="">Pilih Bulan</option>
                        </select>
                        <select id="filterYear" class="form-control" style="width: 150px;">
                            <option value="">Pilih Tahun</option>
                        </select>
                        <button onclick="loadHistory()" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                    <table id="fullHistory">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Masuk</th>
                                <th>Keluar</th>
                                <th>Status</th>
                                <th>Keterlambatan</th>
                                <th>Catatan</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-search fa-2x" style="color: #ddd; margin-bottom: 10px; display: block;"></i>
                                    <span style="color: var(--gray);">Gunakan filter untuk melihat riwayat</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Statistics Content (Hidden by default) -->
            <div id="statisticsContent" style="display: none;">
                <div class="table-container">
                    <h2><i class="fas fa-chart-bar"></i> STATISTIK BULANAN</h2>
                    <div id="statisticsChart" style="height: 300px; margin: 30px 0;">
                        <!-- Chart akan diisi oleh JavaScript -->
                        <div style="display: flex; align-items: flex-end; height: 100%; gap: 20px; justify-content: center;">
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 50px; background: var(--success); border-radius: 8px; margin: 0 auto 10px;"></div>
                                <div>Hadir</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 30px; background: var(--warning); border-radius: 8px; margin: 0 auto 10px;"></div>
                                <div>Terlambat</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 40px; background: var(--info); border-radius: 8px; margin: 0 auto 10px;"></div>
                                <div>Izin/Sakit</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon icon-present">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Hari Kerja</h3>
                                <div class="stat-number" id="totalWorkDays">0</div>
                                <small class="text-muted">Total hari kerja bulan ini</small>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon icon-late">
                                <i class="fas fa-running"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Rata-rata Telat</h3>
                                <div class="stat-number" id="avgLate">0</div>
                                <small class="text-muted">Menit per hari terlambat</small>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon icon-leave">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Persentase Hadir</h3>
                                <div class="stat-number" id="attendancePercentage">0%</div>
                                <small class="text-muted">Dari total hari kerja</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ranking Content (Hidden by default) -->
            <div id="rankingContent" style="display: none;">
                <div class="table-container">
                    <h2><i class="fas fa-trophy"></i> PERINGKAT KARYAWAN TELADAN</h2>
                    <div style="margin-bottom: 20px;">
                        <select id="rankingPeriod" class="form-control" style="width: 200px; display: inline-block;">
                            <option value="month">Bulan Ini</option>
                            <option value="lastmonth">Bulan Lalu</option>
                            <option value="year">Tahun Ini</option>
                        </select>
                        <button onclick="loadRanking()" class="btn btn-primary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <table id="rankingTable">
                        <thead>
                            <tr>
                                <th>Peringkat</th>
                                <th>Nama Karyawan</th>
                                <th>Kehadiran</th>
                                <th>Keterlambatan</th>
                                <th>Izin/Sakit</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-trophy fa-2x" style="color: #ddd; margin-bottom: 10px; display: block;"></i>
                                    <span style="color: var(--gray);">Loading data ranking...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal untuk Absen Masuk -->
    <div class="modal" id="checkinModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-in-alt"></i> ABSEN MASUK</h3>
                <button class="btn-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Jam kerja:</strong> 07:30 - 15:30<br>
                        <strong>Waktu saat ini:</strong> <span id="currentTimeModal">00:00</span>
                    </div>
                </div>
                
                <form id="checkinForm">
                    <div class="form-group">
                        <label for="attendanceType">
                            <i class="fas fa-user-tag"></i> Status Kehadiran
                        </label>
                        <select id="attendanceType" class="form-control">
                            <option value="hadir">Hadir (Normal)</option>
                            <option value="izin">Izin (Dengan catatan)</option>
                            <option value="sakit">Sakit (Dengan catatan)</option>
                            <option value="cuti">Cuti (Dengan catatan)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="notesGroup" style="display: none;">
                        <label for="attendanceNotes">
                            <i class="fas fa-sticky-note"></i> Catatan / Alasan
                        </label>
                        <textarea id="attendanceNotes" class="form-control" rows="3" placeholder="Masukkan alasan izin/sakit/cuti..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="submitCheckIn()" class="btn btn-success" style="width: 100%;">
                    <i class="fas fa-check"></i> KONFIRMASI ABSEN MASUK
                </button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Absen Keluar -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-out-alt"></i> ABSEN KELUAR</h3>
                <button class="btn-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Absen masuk hari ini:</strong> <span id="checkinTimeModal">-</span><br>
                        <strong>Waktu saat ini:</strong> <span id="checkoutTimeDisplay">00:00</span><br>
                        <strong>Jam kerja berakhir:</strong> 15:30
                    </div>
                </div>
                
                <p style="text-align: center; margin: 20px 0;">
                    Apakah Anda yakin ingin melakukan absen keluar?
                </p>
            </div>
            <div class="modal-footer">
                <button onclick="submitCheckOut()" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-check"></i> YA, ABSEN KELUAR SEKARANG
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script>
        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let todayAttendance = null;
        const attendanceSystem = new AttendanceSystem();

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Cek apakah user sudah login
            if (!auth.isLoggedIn()) {
                window.location.href = 'index.html';
                return;
            }
            
            // Dapatkan data user
            currentUser = auth.getCurrentUser();
            
            // Cek role (harus employee)
            if (currentUser.role !== 'employee') {
                window.location.href = 'admin.html';
                return;
            }
            
            // Initialize dashboard
            initializeDashboard();
            
            // Setup navigation
            setupNavigation();
            
            // Update time every second
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });

        // ===== DASHBOARD INITIALIZATION =====
        function initializeDashboard() {
            // Update user info
            document.getElementById('employeeName').textContent = currentUser.name;
            document.getElementById('greeting').textContent = `Selamat ${getGreetingTime()}, ${currentUser.name.split(' ')[0]}!`;
            
            // Load data
            loadTodayAttendance();
            loadStatistics();
            loadRecentHistory();
            loadRankingData();
            
            // Setup modal events
            setupModalEvents();
        }

        // ===== TIME & DATE FUNCTIONS =====
        function updateDateTime() {
            const now = new Date();
            
            // Format date
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('id-ID', dateOptions);
            
            // Format time
            const timeStr = now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Update displays
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('todayDate').textContent = dateStr;
            document.getElementById('currentTimeModal').textContent = timeStr.substring(0, 5);
            document.getElementById('checkoutTimeDisplay').textContent = timeStr.substring(0, 5);
        }

        function getGreetingTime() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Pagi';
            if (hour < 15) return 'Siang';
            if (hour < 18) return 'Sore';
            return 'Malam';
        }

        // ===== ATTENDANCE FUNCTIONS =====
        function loadTodayAttendance() {
            // Ambil data absensi hari ini
            todayAttendance = attendanceSystem.getTodayAttendance(currentUser.id);
            
            if (todayAttendance) {
                // Update status display
                document.getElementById('statusText').textContent = formatStatus(todayAttendance.status);
                document.getElementById('checkInTime').textContent = todayAttendance.checkIn || '-';
                document.getElementById('checkOutTime').textContent = todayAttendance.checkOut || '-';
                document.getElementById('lateMinutes').textContent = todayAttendance.lateMinutes > 0 ? 
                    `${todayAttendance.lateMinutes} menit` : 'Tepat waktu';
                
                // Tampilkan catatan jika ada
                if (todayAttendance.notes) {
                    document.getElementById('notesText').textContent = todayAttendance.notes;
                    document.getElementById('attendanceNotes').style.display = 'block';
                }
                
                // Update checkout modal
                document.getElementById('checkinTimeModal').textContent = todayAttendance.checkIn || '-';
                
                // Update buttons berdasarkan status
                updateAttendanceButtons();
            } else {
                // Reset status jika belum absen
                document.getElementById('statusText').textContent = 'Belum Absen';
                document.getElementById('checkInTime').textContent = '-';
                document.getElementById('checkOutTime').textContent = '-';
                document.getElementById('lateMinutes').textContent = '-';
                
                // Tampilkan tombol absen masuk
                showCheckInButton();
            }
        }

        function formatStatus(status) {
            const statusMap = {
                'hadir': 'Hadir',
                'izin': 'Izin',
                'sakit': 'Sakit',
                'cuti': 'Cuti',
                'alfa': 'Alfa'
            };
            return statusMap[status] || status;
        }

        function showCheckInButton() {
            const buttonsContainer = document.getElementById('attendanceButtons');
            
            // Cek hari libur
            if (attendanceSystem.isDayOff()) {
                buttonsContainer.innerHTML = `
                    <div class="attendance-info">
                        <p>
                            <i class="fas fa-calendar-times"></i>
                            Hari ini adalah hari libur. Tidak ada absensi.
                        </p>
                    </div>
                `;
                return;
            }
            
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // Tombol absen masuk (hijau)
            buttonsContainer.innerHTML = `
                <button onclick="openCheckInModal()" class="btn-attendance btn-checkin">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>ABSEN MASUK</span>
                    <small>${currentHour < 7 || (currentHour === 7 && currentMinute <= 30) ? 
                        'Sampai 07:30' : 'Terlambat'}</small>
                </button>
            `;
        }

        function showCheckOutButton() {
            const buttonsContainer = document.getElementById('attendanceButtons');
            const now = new Date();
            const currentHour = now.getHours();
            
            buttonsContainer.innerHTML = `
                <button onclick="openCheckOutModal()" class="btn-attendance btn-checkout" 
                        ${currentHour < 15 ? 'disabled' : ''}>
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ABSEN KELUAR</span>
                    <small>${currentHour < 15 ? 'Setelah 15:30' : 'Sampai 18:00'}</small>
                </button>
            `;
        }

        function updateAttendanceButtons() {
            if (!todayAttendance) {
                showCheckInButton();
            } else if (todayAttendance.checkIn && !todayAttendance.checkOut) {
                showCheckOutButton();
            } else {
                // Sudah absen keluar
                document.getElementById('attendanceButtons').innerHTML = `
                    <div class="attendance-info">
                        <p>
                            <i class="fas fa-check-circle"></i>
                            Absensi hari ini sudah selesai. Terima kasih!
                        </p>
                    </div>
                `;
            }
        }

        // ===== MODAL FUNCTIONS =====
        function setupModalEvents() {
            // Tampilkan/sembunyikan field catatan berdasarkan status
            document.getElementById('attendanceType').addEventListener('change', function() {
                const notesGroup = document.getElementById('notesGroup');
                if (this.value !== 'hadir') {
                    notesGroup.style.display = 'block';
                } else {
                    notesGroup.style.display = 'none';
                }
            });
        }

        function openCheckInModal() {
            document.getElementById('checkinModal').classList.add('active');
        }

        function openCheckOutModal() {
            document.getElementById('checkoutModal').classList.add('active');
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        function submitCheckIn() {
            const status = document.getElementById('attendanceType').value;
            const notes = document.getElementById('attendanceNotes').value;
            
            // Validasi untuk izin/sakit/cuti
            if (status !== 'hadir' && !notes.trim()) {
                alert('Harap isi catatan untuk izin/sakit/cuti');
                return;
            }
            
            // Proses absen masuk
            const result = attendanceSystem.addAttendance(currentUser.id, status, notes);
            
            if (result) {
                showNotification(`Absen ${result.action} berhasil!`, 'success');
                closeModal();
                
                // Refresh data
                loadTodayAttendance();
                loadStatistics();
                loadRecentHistory();
            } else {
                showNotification('Gagal melakukan absen', 'error');
            }
        }

        function submitCheckOut() {
            // Proses absen keluar
            const result = attendanceSystem.addAttendance(currentUser.id);
            
            if (result && result.action === 'checkout') {
                showNotification('Absen keluar berhasil!', 'success');
                closeModal();
                
                // Refresh data
                loadTodayAttendance();
                loadStatistics();
                loadRecentHistory();
            } else {
                showNotification('Gagal melakukan absen keluar', 'error');
            }
        }

        // ===== STATISTICS FUNCTIONS =====
        function loadStatistics() {
            const stats = attendanceSystem.getMonthlyStats(currentUser.id);
            
            // Update stat cards
            document.getElementById('presentCount').textContent = stats.present;
            document.getElementById('lateCount').textContent = stats.late;
            document.getElementById('leaveCount').textContent = stats.sick + stats.permit;
            document.getElementById('permitCount').textContent = stats.permit;
            document.getElementById('sickCount').textContent = stats.sick;
            document.getElementById('absentCount').textContent = stats.alfa;
            document.getElementById('totalLateMinutes').textContent = stats.late * 5; // Estimasi
            
            // Update progress bar
            const percentage = stats.attendanceRate;
            document.getElementById('attendanceProgress').style.width = `${percentage}%`;
            document.getElementById('attendancePercent').textContent = `${percentage}%`;
        }

        // ===== HISTORY FUNCTIONS =====
        function loadRecentHistory() {
            const history = attendanceSystem.getAttendanceHistory(currentUser.id, 5);
            const tbody = document.querySelector('#recentHistory tbody');
            
            tbody.innerHTML = '';
            
            if (history.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-history fa-2x" style="margin-bottom: 10px; display: block;"></i>
                            Belum ada riwayat absensi
                        </td>
                    </tr>
                `;
                return;
            }
            
            history.forEach(record => {
                const statusClass = getStatusClass(record.status, record.lateMinutes);
                const statusText = getStatusText(record.status, record.lateMinutes);
                const lateText = record.lateMinutes > 0 ? `${record.lateMinutes} menit` : '-';
                
                const row = `
                    <tr>
                        <td>${formatDisplayDate(record.date)}</td>
                        <td>${record.checkIn || '-'}</td>
                        <td>${record.checkOut || '-'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${lateText}</td>
                        <td>${record.notes || '-'}</td>
                    </tr>
                `;
                
                tbody.innerHTML += row;
            });
        }

        function loadHistory() {
            // Implementasi filter history
            console.log('Loading filtered history...');
        }

        // ===== RANKING FUNCTIONS =====
        function loadRankingData() {
            const topPerformers = attendanceSystem.getTopPerformers(5);
            const rankingList = document.getElementById('rankingList');
            
            if (!rankingList) return;
            
            rankingList.innerHTML = '';
            
            topPerformers.forEach((performer, index) => {
                const isCurrentUser = performer.employeeId === currentUser.id;
                
                const item = document.createElement('div');
                item.className = `ranking-item ${isCurrentUser ? 'me' : ''} rank-${index + 1}`;
                
                item.innerHTML = `
                    <div class="rank-number">${index + 1}</div>
                    <div class="rank-info">
                        <div class="rank-name">${performer.name} ${isCurrentUser ? '(Anda)' : ''}</div>
                        <div class="rank-stats">
                            <span>Hadir: ${performer.present}</span>
                            <span>Telat: ${performer.lateCount}</span>
                            <span>Izin: ${performer.permit + performer.sick}</span>
                        </div>
                    </div>
                    <div class="rank-score">${performer.score}</div>
                `;
                
                rankingList.appendChild(item);
            });
        }

        function loadRanking() {
            // Implementasi load ranking dengan filter
            console.log('Loading ranking...');
        }

        // ===== NAVIGATION =====
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.sidebar-menu a');
            const contents = ['dashboardContent', 'historyContent', 'statisticsContent', 'rankingContent'];
            
            navLinks.forEach((link, index) => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active class
                    navLinks.forEach(l => l.parentElement.classList.remove('active'));
                    link.parentElement.classList.add('active');
                    
                    // Show selected content
                    contents.forEach((contentId, i) => {
                        const element = document.getElementById(contentId);
                        if (element) {
                            element.style.display = i === index ? 'block' : 'none';
                        }
                    });
                    
                    // Load specific data jika diperlukan
                    if (index === 1) { // History
                        loadHistory();
                    } else if (index === 2) { // Statistics
                        // Load detailed statistics
                    } else if (index === 3) { // Ranking
                        loadRanking();
                    }
                });
            });
        }

        // ===== UTILITY FUNCTIONS =====
        function formatDisplayDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function getStatusClass(status, lateMinutes) {
            if (status === 'hadir' && lateMinutes > 0) return 'badge-late';
            if (status === 'hadir') return 'badge-present';
            if (status === 'sakit') return 'badge-sick';
            if (status === 'izin' || status === 'cuti') return 'badge-permit';
            if (status === 'alfa') return 'badge-absent';
            return '';
        }

        function getStatusText(status, lateMinutes) {
            if (status === 'hadir' && lateMinutes > 0) return 'Terlambat';
            if (status === 'hadir') return 'Hadir';
            if (status === 'sakit') return 'Sakit';
            if (status === 'izin') return 'Izin';
            if (status === 'cuti') return 'Cuti';
            if (status === 'alfa') return 'Alfa';
            return status;
        }

        function showNotification(message, type = 'info') {
            // Implementasi notifikasi
            alert(`[${type.toUpperCase()}] ${message}`);
        }

        function logout() {
            auth.logout();
        }

        // Make functions available globally
        window.openCheckInModal = openCheckInModal;
        window.openCheckOutModal = openCheckOutModal;
        window.closeModal = closeModal;
        window.submitCheckIn = submitCheckIn;
        window.submitCheckOut = submitCheckOut;
        window.logout = logout;
        window.loadHistory = loadHistory;
        window.loadRanking = loadRanking;
    </script>
</body>
</html>
